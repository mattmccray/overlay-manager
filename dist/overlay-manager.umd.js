!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).overlayManager={})}(this,function(e){let t=Symbol("clean"),n=[],r=0,o=e=>{let o,i=[],s={lc:0,value:e,set(e){s.value=e,s.notify()},get:()=>(s.lc||s.listen(()=>{})(),s.value),notify(e){o=i;let t=!n.length;for(let t=0;t<o.length;t++)n.push(o[t],s.value,e);if(t){r++;for(let e=0;e<n.length;e+=3)n[e](n[e+1],n[e+2]);n.length=0}},listen:e=>(i===o&&(i=i.slice()),s.lc=i.push(e),()=>{i===o&&(i=i.slice());let t=i.indexOf(e);~t&&(i.splice(t,1),s.lc--,s.lc||s.off())}),subscribe(e){let t=s.listen(e);return e(s.value),t},off(){}};return"production"!==process.env.NODE_ENV&&(s[t]=()=>{i=[],s.lc=0,s.off()}),s},i=(e,n)=>{let i;Array.isArray(e)||(e=[e]);let s=[],l=()=>{let t=e.map(e=>e.get());(i!==r||t.some((e,t)=>e!==s[t]))&&(i=r,s=t,u.set(n(...t)))},u=o();var f,c,a,v,d;return c=()=>{let t=e.map(e=>e.listen(l,n));return l(),()=>{for(let e of t)e()}},v=e=>{let t=c();t&&f.events[6].push(t)},d=e=>{let n=f.listen;f.listen=t=>(f.lc||f.active||(e(),f.active=!0),n(t));let r=f.off;if(f.events[6]=[],f.off=()=>{setTimeout(()=>{if(f.active&&!f.lc){f.active=!1;for(let e of f.events[6])e();f.events[6]=[],r()}},1e3)},"production"!==process.env.NODE_ENV){let e=f[t];f[t]=()=>{for(let e of f.events[6])e();f.events[6]=[],f.active=!1,e()}}return()=>{f.listen=n,f.off=r}},(a=f=u).events=a.events||{},a.events[15]||(a.events[15]=d(e=>{a.events[5].reduceRight((e,t)=>(t(e),e),{shared:{},...e})})),a.events[5]=a.events[5]||[],a.events[5].push(v),u};function s(){var e={isResolved:!1,resolve:null,reject:null},t=new Promise(function(t,n){e.resolve=function(n){e.isResolved=!0,t(n)},e.reject=function(t){e.isResolved=!0,n(t)}});return[Object.assign(t,{innerPromise:t,get isResolved(){return e.isResolved}}),e]}var l=o([]);function u(e){var t=l.get();return t.unshift(e),l.set(t),function(){f(e)}}function f(e){var t=l.get();l.set(t.filter(function(t){return t!==e}))}function c(e){if("Escape"===e.key&&!e.repeat)for(var t=l.get(),n=0;n<t.length;n++)if(!0===(0,t[n])(e)){e.preventDefault(),e.stopPropagation();break}}i(l,function(e){return e.length>0}).subscribe(function(e){e?window.addEventListener("keydown",c):window.removeEventListener("keydown",c)}),e.createDeferred=s,e.createOverlayManager=function(e,t){void 0===t&&(t=null);var n=o([]),r=i(n,function(e){return e.length>0}),l=i(n,function(e){return e[e.length-1]}),f=i(n,function(e){return e}),c=u(function(e){var n=l.get();n&&n.returnValue(null,t)});return{name:e,isActive:r,topmost:l,show:function(e,r,o){try{var u=function(e){return e()},f=Date.now().toString(36),c=i(l,function(e){return(null==e?void 0:e.id)===f}),a=s(),v=a[0],d=a[1],p={id:f,view:e,params:r,options:o,isTopmost:c,returnValue:function(e,r){u(function(){r||r===t?d.reject(r):d.resolve(e),n.set([].concat(n.get().filter(function(e){return e.id!==f})))})},onRequestClose:function(e){u=e}};return n.set([].concat(n.get(),[p])),Promise.resolve(v.innerPromise)}catch(e){return Promise.reject(e)}},stopEscListening:c,overlays:f}},e.removeEscHandler=f,e.useEscHandler=u});
