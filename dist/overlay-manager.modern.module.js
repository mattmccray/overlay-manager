let e=Symbol("clean"),t=[],n=0,r=r=>{let o,i=[],s={lc:0,value:r,set(e){s.value=e,s.notify()},get:()=>(s.lc||s.listen(()=>{})(),s.value),notify(e){o=i;let r=!t.length;for(let n=0;n<o.length;n++)t.push(o[n],s.value,e);if(r){n++;for(let e=0;e<t.length;e+=3)t[e](t[e+1],t[e+2]);t.length=0}},listen:e=>(i===o&&(i=i.slice()),s.lc=i.push(e),()=>{i===o&&(i=i.slice());let t=i.indexOf(e);~t&&(i.splice(t,1),s.lc--,s.lc||s.off())}),subscribe(e){let t=s.listen(e);return e(s.value),t},off(){}};return"production"!==process.env.NODE_ENV&&(s[e]=()=>{i=[],s.lc=0,s.off()}),s},o=(t,o)=>{let i;Array.isArray(t)||(t=[t]);let s=[],l=()=>{let e=t.map(e=>e.get());(i!==n||e.some((e,t)=>e!==s[t]))&&(i=n,s=e,u.set(o(...e)))},u=r();var c,f,v,a,g;return f=()=>{let e=t.map(e=>e.listen(l,o));return l(),()=>{for(let t of e)t()}},a=e=>{let t=f();t&&c.events[6].push(t)},g=t=>{let n=c.listen;c.listen=e=>(c.lc||c.active||(t(),c.active=!0),n(e));let r=c.off;if(c.events[6]=[],c.off=()=>{setTimeout(()=>{if(c.active&&!c.lc){c.active=!1;for(let e of c.events[6])e();c.events[6]=[],r()}},1e3)},"production"!==process.env.NODE_ENV){let t=c[e];c[e]=()=>{for(let e of c.events[6])e();c.events[6]=[],c.active=!1,t()}}return()=>{c.listen=n,c.off=r}},(v=c=u).events=v.events||{},v.events[15]||(v.events[15]=g(e=>{v.events[5].reduceRight((e,t)=>(t(e),e),{shared:{},...e})})),v.events[5]=v.events[5]||[],v.events[5].push(a),u};function i(e,t){void 0===t&&(t=null);var n=r([]),i=o(n,function(e){return e.length>0}),l=o(n,function(e){return e[e.length-1]}),c=o(n,function(e){return e}),f=u(function(e){var n=l.get();n&&n.returnValue(null,t)});return{name:e,isActive:i,topmost:l,show:function(e,r,i){try{var u=function(e){return e()},c=Date.now().toString(36),f=o(l,function(e){return(null==e?void 0:e.id)===c}),v=s(),a=v[0],g=v[1],p={id:c,view:e,params:r,options:i,isTopmost:f,returnValue:function(e,r){u(function(){r||r===t?g.reject(r):g.resolve(e),n.set([].concat(n.get().filter(function(e){return e.id!==c})))})},onRequestClose:function(e){u=e}};return n.set([].concat(n.get(),[p])),Promise.resolve(a.innerPromise)}catch(e){return Promise.reject(e)}},stopEscListening:f,overlays:c}}function s(){var e={isResolved:!1,resolve:null,reject:null},t=new Promise(function(t,n){e.resolve=function(n){e.isResolved=!0,t(n)},e.reject=function(t){e.isResolved=!0,n(t)}});return[Object.assign(t,{innerPromise:t,get isResolved(){return e.isResolved}}),e]}var l=r([]);function u(e){var t=l.get();return t.unshift(e),l.set(t),function(){c(e)}}function c(e){var t=l.get();l.set(t.filter(function(t){return t!==e}))}function f(e){if("Escape"===e.key&&!e.repeat)for(var t=l.get(),n=0;n<t.length;n++)if(!0===(0,t[n])(e)){e.preventDefault(),e.stopPropagation();break}}o(l,function(e){return e.length>0}).subscribe(function(e){e?window.addEventListener("keydown",f):window.removeEventListener("keydown",f)});export{s as createDeferred,i as createOverlayManager,c as removeEscHandler,u as useEscHandler};
