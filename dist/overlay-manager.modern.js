let e=Symbol("clean"),t=[],n=0,s=s=>{let l,o=[],i={lc:0,value:s,set(e){i.value=e,i.notify()},get:()=>(i.lc||i.listen(()=>{})(),i.value),notify(e){l=o;let s=!t.length;for(let n=0;n<l.length;n++)t.push(l[n],i.value,e);if(s){n++;for(let e=0;e<t.length;e+=3)t[e](t[e+1],t[e+2]);t.length=0}},listen:e=>(o===l&&(o=o.slice()),i.lc=o.push(e),()=>{o===l&&(o=o.slice());let t=o.indexOf(e);~t&&(o.splice(t,1),i.lc--,i.lc||i.off())}),subscribe(e){let t=i.listen(e);return e(i.value),t},off(){}};return"production"!==process.env.NODE_ENV&&(i[e]=()=>{o=[],i.lc=0,i.off()}),i},l=(t,l)=>{let o;Array.isArray(t)||(t=[t]);let i=[],r=()=>{let e=t.map(e=>e.get());(o!==n||e.some((e,t)=>e!==i[t]))&&(o=n,i=e,c.set(l(...e)))},c=s();var u,v,f,a,g;return v=()=>{let e=t.map(e=>e.listen(r,l));return r(),()=>{for(let t of e)t()}},a=e=>{let t=v();t&&u.events[6].push(t)},g=t=>{let n=u.listen;u.listen=e=>(u.lc||u.active||(t(),u.active=!0),n(e));let s=u.off;if(u.events[6]=[],u.off=()=>{setTimeout(()=>{if(u.active&&!u.lc){u.active=!1;for(let e of u.events[6])e();u.events[6]=[],s()}},1e3)},"production"!==process.env.NODE_ENV){let t=u[e];u[e]=()=>{for(let e of u.events[6])e();u.events[6]=[],u.active=!1,t()}}return()=>{u.listen=n,u.off=s}},(f=u=c).events=f.events||{},f.events[15]||(f.events[15]=g(e=>{f.events[5].reduceRight((e,t)=>(t(e),e),{shared:{},...e})})),f.events[5]=f.events[5]||[],f.events[5].push(a),c};function o(e,t=null){const n=s([]),o=l(n,e=>e.length>0),r=l(n,e=>e[e.length-1]),u=l(n,e=>e),v=c(function(e){const n=r.get();n&&n.returnValue(null,t)});return{name:e,isActive:o,topmost:r,show:async function(e,s,o){let c=e=>e();const u=Date.now().toString(36),v=l(r,e=>(null==e?void 0:e.id)===u),[f,a]=i(),g={id:u,view:e,params:s,options:o,isTopmost:v,returnValue:function(e,s){c(()=>{s||s===t?a.reject(s):a.resolve(e),n.set([...n.get().filter(e=>e.id!==u)])})},onRequestClose:function(e){c=e}};return n.set([...n.get(),g]),f.innerPromise},stopEscListening:v,overlays:u}}function i(){const e={isResolved:!1,resolve:null,reject:null},t=new Promise((t,n)=>{e.resolve=n=>{e.isResolved=!0,t(n)},e.reject=t=>{e.isResolved=!0,n(t)}});return[Object.assign(t,{innerPromise:t,get isResolved(){return e.isResolved}}),e]}const r=s([]);function c(e){const t=r.get();return t.unshift(e),r.set(t),()=>{u(e)}}function u(e){const t=r.get();r.set(t.filter(t=>t!==e))}function v(e){if("Escape"===e.key&&!e.repeat){const t=r.get();for(let n=0;n<t.length;n++)if(!0===(0,t[n])(e)){e.preventDefault(),e.stopPropagation();break}}}l(r,e=>e.length>0).subscribe(e=>{e?window.addEventListener("keydown",v):window.removeEventListener("keydown",v)});export{i as createDeferred,o as createOverlayManager,u as removeEscHandler,c as useEscHandler};
